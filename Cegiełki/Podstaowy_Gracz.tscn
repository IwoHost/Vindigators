[gd_scene load_steps=10 format=3 uid="uid://ef0va6jke65y"]

[ext_resource type="Texture2D" uid="uid://bhqxyo6lkvsr1" path="res://Sprity/icon.svg" id="1_txnuc"]
[ext_resource type="Texture2D" uid="uid://fjyospklx3ex" path="res://Sprity/vinmlot.png" id="2_x2l43"]
[ext_resource type="Script" path="res://Kod/DashComponent.gd" id="3_bex0t"]
[ext_resource type="Script" path="res://Kod/AttackComponent.gd" id="4_q0kp1"]
[ext_resource type="Resource" uid="uid://bhmqus0opafoh" path="res://Kod/Bronie_Skrypt/Listonosz.tres" id="5_eh5no"]
[ext_resource type="Resource" uid="uid://bnmphscg4i81t" path="res://Kod/Bronie_Skrypt/Mlot_Bojowy.tres" id="5_rpqg5"]

[sub_resource type="GDScript" id="GDScript_6mlio"]
script/source = "extends CharacterBody2D

# --- POWRÓT DO MOCNEGO RUCHU ---
@export var speed = 400.0
@export var jump_velocity = -400.0
@export var bhop_boost = 60.0      
@export var max_bhop_speed = 900.0 

var current_speed = 400.0          
var kierunek_patrzenia = 1 
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")

@onready var dash = $DashComponent
@onready var attack = $AttackComponent

func _physics_process(delta):
	# 1. GRAWITACJA (Standardowa)
	if not is_on_floor() and not dash.is_dashing:
		velocity.y += gravity * delta

	# 2. DASH
	if Input.is_action_just_pressed(\"dash\") and not attack.czy_atakuje:
		dash.start_dash(self)

	# 3. SKOK + B-HOP
	if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor() and not dash.is_dashing:
		velocity.y = jump_velocity
		current_speed = clamp(current_speed + bhop_boost, speed, max_bhop_speed)

	# 4. RUCH (Prostszy, bardziej responsywny)
	var direction = Input.get_axis(\"ui_left\", \"ui_right\")
	
	if dash.is_dashing:
		# Podczas dasha blokujemy Y, ale nie ruszamy X (pozwalamy mu lecieć z siłą impulsu)
		velocity.y = 0 
	else:
		if direction:
			# Powrót do bezpośredniego ustawiania prędkości - daje lepszy \"feeling\"
			velocity.x = direction * current_speed
			kierunek_patrzenia = sign(direction)
			$Sprite2D.flip_h = (direction < 0)
			$HammerZone.scale.x = kierunek_patrzenia
		else:
			# Płynne wyhamowanie, gdy nic nie trzymasz
			var friction = 2000 if not attack.czy_atakuje else 500
			velocity.x = move_toward(velocity.x, 0, friction * delta)
			
			if is_on_floor() and not attack.czy_atakuje:
				current_speed = speed

	# 5. OGRANICZENIA (Tylko delikatne, żeby nie psuć zabawy)
	if is_on_floor() and not Input.is_action_pressed(\"ui_accept\"):
		current_speed = move_toward(current_speed, speed, delta * 500)

	move_and_slide()
	
	# 6. ATAK (Młot niszczący drzwi)
	if Input.is_action_just_pressed(\"ui_attack\") and not attack.czy_atakuje:
		attack.wykonaj_atak(self)
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_aq83t"]
size = Vector2(128, 128)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ycx2w"]
size = Vector2(112, 112)

[node name="Player" type="CharacterBody2D" groups=["gracz"]]
z_index = 1
script = SubResource("GDScript_6mlio")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_txnuc")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_aq83t")

[node name="HammerZone" type="Area2D" parent="."]
position = Vector2(80, 16)

[node name="CollisionShape2D" type="CollisionShape2D" parent="HammerZone"]
position = Vector2(-80, -16)
shape = SubResource("RectangleShape2D_ycx2w")

[node name="Sprite2D" type="Sprite2D" parent="HammerZone"]
visible = false
position = Vector2(66.7097, 24.1183)
scale = Vector2(0.0929032, 0.0814201)
texture = ExtResource("2_x2l43")

[node name="DashComponent" type="Node" parent="."]
script = ExtResource("3_bex0t")

[node name="AttackComponent" type="Node" parent="."]
script = ExtResource("4_q0kp1")
obecna_bron = ExtResource("5_eh5no")
ekwipunek = Array[Resource("res://Kod/Bronie_Skrypt/WeaponData_Podstawowe.gd")]([ExtResource("5_rpqg5"), ExtResource("5_eh5no")])
